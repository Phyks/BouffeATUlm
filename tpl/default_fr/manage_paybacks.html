{include="header"}

{if condition="!empty($list)"}
    <h2>Gérer les remboursements globaux</h2>
        <p class="center"><a href="?do=manage_paybacks&new=1">Ajouter un remboursement global</a></p>

        {if condition="$global_paybacks !== FALSE"}
            <p>Liste des remboursements globaux précédents :</p>
            <dl>
                {loop="$global_paybacks"}
                <dt>{$value->getDate()}</dt>
                <dd>{if condition="$value->getClosed() === true"}[Terminé] {/if}<a href="?do=see_paybacks&id={$value->getId()}">Remboursement n°{$value->getId()}</a></dd>
                {/loop}
            </dl>
        {/if}
{else}
    <h2>Ajouter un remboursement global</h2>
    <p>Cette page vous permet d'ajouter un remboursement global. Un tel remboursement permet de simplifier au maximum les remboursements. Ainsi, le tableau de la page d'accueil sera remis à zéro et un nouveau tableau sera créé, tableau qui simplifiera les échanges.</p>

    <p>Par exemple, si A doit 5{$currency} à B et B doit 5{$currency} à C, après remboursement global, ces remboursements se simplifieront en A doit 5{$currency} à C.</p>

    <p><strong>Note : <span class="red">Cette opération est irréversible sans mettre les mains dans la base de données.</span></strong></p>

    <p><strong>Note :</strong> Un backup de votre base de données à l'heure actuelle sera effectué et stocké dans le répertoire db_backups à la racine de l'instance. Vous pourrez ainsi restaurer la base de données en cas d'erreur de votre part.</p>

    <hr/>

    <p>Si vous confirmez la création d'un remboursement global, veuillez sélectionner ci-dessous les utilisateurs que vous souhaitez inclure dans le remboursement.</p>

    <form method="post" action="?do=manage_paybacks&new=1" id="global_payback_form">
        <fieldset>
            <legend>Utilisateurs à inclure</legend>
            {loop="$users"}
                <input type="checkbox" id="users_in_{$value->getId()}" name="users_in[]" value="{$value->getId()}"/>
                <label for="users_in_{$value->getId()}">{$value->getDisplayName()}</label><br/>
            {/loop}
    </fieldset>
    <p>
        <input type="submit" onclick="return confirm('Vous êtes sur le point d\'ajouter un remboursement global incluant les utilisateurs sélectionnés.');" value="Valider"/>
        <input type="hidden" name="token" value="{$token}"/>
    </p>
    </form>
{/if}
{include="footer"}
