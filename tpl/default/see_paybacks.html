{include="header"}

{if condition="empty($id)"}
    <h2>Global paybacks list</h2>
        {if condition="$global_paybacks !== FALSE"}
            <dl>
                {loop="$global_paybacks"}
                <dt>{$value->getDate()}</dt>
                <dd>
                    {if condition="$value->getClosed() === false"}
                         <a href="?do=see_paybacks&id={$value->getId()}">Payback n°{$value->getId()}</a>
                    {else}
                        [Closed] Payback n°{$value->getId()}
                    {/if}
                </dd>
                {/loop}
            </dl>
        {else}
            <p>No global paybacks available.</p>
        {/if}
{else}
    {if condition="$global_paybacks === false"}
        Payback doesn't exist.
    {else}
        <h2>Payback n°{$global_paybacks->getId()}</h2>

        {$table=$global_paybacks->getUsersIn()->get()}
        <table id="global_paybacks_table">
            <tr>
                <th>Owes / To</th>
                {loop="$global_paybacks->getUsersIn()->get()"}
                <th>{if condition="!empty($users[$key1])"}{$users[$key1]->getDisplayName()}{else}Deleted user{/if}</th>
                {/loop}
            </tr>
            {loop="$global_paybacks->getUsersIn()->get()"}
                <tr>
                    <th>{if condition="!empty($users[$key1])"}{$users[$key1]->getDisplayName()}{else}Deleted user{/if}</th>
                    {loop="$global_paybacks->getUsersIn()->get()"}
                        {if condition="$key1 == $key2"}
                            <td class="cell-disabled"></td>
                        {else}
                            <td>
                                {if condition="$table[$key1][$key2] != 0"}
                                <a href="?do=confirm_global_paybacks&amp;from={$key1}&amp;to={$key2}&amp;payback_id={$global_paybacks->getId()}&amp;token={$token}" title="Confirm payback" onclick="return confirm("Are you sure you want to confirm this payback ? This action can't be undone easily");">{$table[$key1][$key2]}</a>
                                {else}
                                    -
                                {/if}
                            </td>
                        {/if}
                    {/loop}
                </tr>
            {/loop}
        </table>
    {/if}

    <p class="center"><a href="?do=see_paybacks">Go back to global paybacks list</a></p>
{/if}
{include="footer"}
